# NeoJiLang 更新日志

## [0.1.4] - 2025-05-30

### 新增功能

- 添加了逻辑运算语句支持：
  - `logic.and` - 逻辑与操作，支持短路求值
  - `logic.or` - 逻辑或操作，支持短路求值
  - `logic.not` - 逻辑非操作
- 所有逻辑运算支持不同数据类型的真值判断
- 逻辑运算可以与控制流语句结合使用，增强条件表达能力
- 增强了变量访问能力，支持嵌套变量路径：
  - 支持多层对象属性访问，如 `person.address.city`
  - 支持数组索引访问，如 `hobbies[0]`
  - 支持混合嵌套路径，如 `company.departments[0].employees[1].name`
  - 支持通过嵌套路径设置变量值，自动创建中间结构
- 实现了通用的路径解析和访问系统，统一处理变量和JSON嵌套路径：
  - 创建了专用的路径解析器，支持对象属性和数组索引混合的路径
  - 添加了`utils::path`模块，提供统一的路径操作功能
- 增强了JSON操作功能，支持嵌套路径访问和修改：
  - `json.get`支持通过点表示法访问嵌套属性，如`json.get(obj, "user.profile.name")`
  - `json.set`支持通过点表示法设置嵌套属性，如`json.set(obj, "user.address.city", "北京")`
  - `json.get`和`json.set`支持数组索引访问，如`"items[0].name"`
  - 自动创建嵌套路径中的中间结构（对象或数组）
- 优化了错误处理机制，提高了用户体验：
  - 在访问不存在的嵌套路径时返回`null`而不是抛出错误
  - 为嵌套路径访问提供更友好的错误信息

### 架构改进

- 扩展了错误提示系统，添加了逻辑运算相关的错误类型
- 优化了逻辑运算的短路求值机制，提高执行效率
- 添加了完整的逻辑运算示例程序
- 重构了变量处理机制，支持更复杂的变量路径解析
- 增强了变量路径解析器，能够处理对象属性和数组索引的混合路径
- 重构了路径处理系统，采用统一的路径解析和访问机制：
  - 定义了`PathPart`枚举，统一表示对象属性和数组索引
  - 实现了`parse_path`函数，将字符串路径解析为结构化的路径部分
  - 添加了`get_nested_value`和`set_nested_value`函数，用于统一处理嵌套值的获取和设置
- 优化了打印语句处理器，改进数组参数的处理方式：
  - `print`语句现在能正确处理数组参数，将其作为字符串连接处理
  - 改进了打印功能的变量替换机制，显示更友好的输出结果

### 问题修复

- 修复了无法通过嵌套路径访问变量的问题
- 修复了无法通过数组索引访问元素的问题
- 修复了无法通过嵌套路径设置变量值的问题
- 修复了在使用`json.set`时无法正确处理嵌套路径的问题
- 修复了`json.get`在路径不存在时抛出错误而不是返回`null`的问题
- 修复了在空对象上无法创建嵌套结构的问题
- 修复了`print`处理器无法正确处理数组参数的问题，导致变量值不被替换
- 消除了代码中的编译警告，提高代码质量

## [0.1.3] - 2025-05-29

### 新增功能

- 添加了完整的控制流语句支持：
  - `if` - 条件判断语句，支持 `then` 和可选的 `else` 分支
  - `loop.while` - 条件循环，当条件为真时重复执行
  - `loop.for` - 计数循环，执行指定次数
  - `loop.foreach` - 集合遍历循环，支持数组和对象
  - `loop.break` - 跳出当前循环
  - `loop.continue` - 跳过当前循环迭代，继续下一次迭代
- 所有控制流语句支持单个语句或语句数组作为执行体
- 循环语句支持变量绑定，可以访问当前迭代的索引和值

### 架构改进

- 增强了错误处理系统，添加了循环控制相关的错误类型
- 添加了控制流相关的错误提示信息，提高调试体验
- 优化了语句执行机制，支持嵌套控制流结构

## [0.1.2] - 2025-05-29

### 新增功能

- 扩展了核心语句集，实现了JSON操作系列语句，用于创建、查询和修改JSON数据结构：
  - `json.new` - 创建新的JSON对象或数组，支持嵌套语句
  - `json.get` - 获取JSON对象的属性或数组的元素
  - `json.set` - 设置JSON对象的属性或数组的元素
  - 所有JSON操作均支持变量引用和嵌套语句，实现复杂数据处理

### 架构改进

- 优化了语句处理机制，支持对象和数组的递归处理
- 改进了核心语句集的扩展机制，使添加新语句更加简便
- 增强了错误提示系统，提供更加详细的JSON操作错误信息

## [0.1.1] - 2025-05-28

### 新增功能

- 添加了内置模块系统和动态导入机制
- 实现了IO模块，提供文件读写和标准输入输出功能：
  - `io.readFile` - 读取文件内容，支持编码选项（UTF-8, GB2312/GBK）
  - `io.writeFile` - 写入文件，支持编码选项（UTF-8, GB2312/GBK）
  - `io.readLine` - 读取一行输入
  - `io.input` - 显示提示并读取输入
- 增强了NJIL导入系统，支持内置模块的导入
- NJIS现在会自动导入所有内置模块，无需显式声明
- 为两种文件格式添加了不同的模块加载策略：
  - NJIL: 按需加载，通过`import`语句显式声明
  - NJIS: 自动加载所有内置模块，简化使用
- 添加了通用内容解析方法，统一处理变量引用和表达式

### 架构改进

- 设计了`BuiltinModule`特性，统一内置模块的接口
- 实现了`BuiltinModuleRegistry`，用于管理和查找内置模块
- 增强了解释器，支持动态加载模块和处理导入语句
- 改进了语句注册系统，支持动态注册处理器

## [0.1.0] - 2025-05-28

### 新增功能

- 实现了基本的NJIL解释器框架
- 添加了核心语句处理功能：
  - `print` - 打印语句输出
  - `var` - 变量获取
  - `var.set` - 变量设置
  - `return` - 返回值处理
  - `string.concat` 和 `txtlink` - 字符串连接操作
- 引入了模块化的语句处理系统，使用`StatementHandler`特质
- 实现了动态语句处理器注册机制，支持语句别名
- 添加了集中式错误提示管理系统，便于国际化和维护
- 支持从文件加载和执行NJIL程序
- 添加了NJIS (NeoJi Script) 格式支持，使用`.njis`扩展名
  - NJIS是一种简化版的NJIL，使用JSON数组直接表示语句序列
  - 自动识别文件扩展名并选择适当的解析器

### 架构改进

- 采用模块化设计，将不同类型的语句处理逻辑分离到独立模块
- 使用特质（trait）定义统一的语句处理接口
- 实现了静态单例模式的语句处理器，提高性能
- 使用`OnceLock`实现线程安全的全局语句注册表
- 错误提示信息集中管理，便于维护和国际化

### 开发体验

- 清晰的代码组织结构，便于扩展新功能
- 详细的代码注释，提高可读性
- 统一的错误处理机制

### 已知问题

- 尚未实现更复杂的语句类型，如条件判断和循环
- 错误提示目前仅支持中文

### 下一步计划

- 添加更多语句类型支持
- 实现函数调用机制
- 增强错误处理和调试功能
- 考虑添加国际化支持 